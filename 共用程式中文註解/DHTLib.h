/*****************************************************************
檔案名稱：DHTLib.h
描述：溫溼度感測器函式庫
功能：提供 BM25S2021-1 溫溼度感測模組的初始化、資料讀取、裝置資訊查詢等功能
通訊介面：I2C (Wire1)
******************************************************************/

// ================================================================
// =============== 全域變數宣告區 (Global Variables) ===============
// ================================================================

// 溫度值全域變數：儲存最新讀取的溫度值（單位：攝氏度）
float TValue = 0;

// 濕度值全域變數：儲存最新讀取的濕度值（單位：百分比）
float HValue = 0;

// 感測器資訊字串：用於儲存產品序號、產品ID、韌體版本等文字資訊
String DHTStr;

// ================================================================
// =============== 函式庫引入區 (Library Includes) ================
// ================================================================

// 引入 Arduino 標準字串處理函式庫
#include "String.h"

// 引入 BM25S2021-1 溫溼度感測模組專用函式庫
// 該函式庫提供與 BM25S2021-1 感測器通訊的底層函式
#include "BM25S2021-1.h"

// ================================================================
// =============== 感測器物件實例化區 (Sensor Object) =============
// ================================================================

/*
建立 BM25S2021_1 感測器物件，命名為 BMht
通訊介面選擇：
  1. &Wire    - 使用 Arduino 預設的 I2C 介面（通常為 SDA: A4, SCL: A5）
  2. &Wire1   - 使用第一組額外的 I2C 介面（本程式選用此選項）
  3. &Wire2   - 使用第二組額外的 I2C 介面（如開發板支援）

注意：不同的 Arduino 開發板可能提供不同數量的 I2C 介面
*/
BM25S2021_1 BMht(&Wire1);  // 透過第一組 I2C 介面讀取溫溼度感測模組

// ================================================================
// =============== 函式宣告區 (Function Declarations) =============
// ================================================================

/*
函式名稱：initDHT()
功能：初始化溫溼度感測器，啟動 I2C 通訊
參數：無
傳回值：無
*/
void initDHT();

/*
函式名稱：readTemperature()
功能：讀取溫度值
參數：無
傳回值：float - 溫度值（攝氏度）
*/
float readTemperature();

/*
函式名稱：readHumidity()
功能：讀取濕度值
參數：無
傳回值：float - 濕度值（百分比）
*/
float readHumidity();

/*
函式名稱：getVersion()
功能：讀取感測器韌體版本號
參數：無
傳回值：String - 韌體版本字串
*/
String getVersion();

/*
函式名稱：getProductNumber()
功能：讀取產品編號（Product ID）
參數：無
傳回值：String - 產品編號字串
備註：函式名稱有拼寫錯誤，應為 getProductNumber()
*/
String getProductNumbetr();

/*
函式名稱：getSNNumber()
功能：讀取產品序號（Serial Number）
參數：無
傳回值：String - 產品序號字串
備註：函式名稱有拼寫錯誤，應為 getSNNumber()
*/
String getSNNumbetr();

/*
函式名稱：ShowDHTInformation()
功能：印出溫溼度感測器的完整產品資訊
包含：序號(SN)、產品ID(PID)、韌體版本(VER)
參數：無
傳回值：無
*/
void ShowDHTInformation();

// ================================================================
// =============== 函式實作區 (Function Implementations) ==========
// ================================================================

// ---------------------------------------------------------------
// 函式名稱：initDHT()
// 功能：初始化溫溼度感測器，啟動 I2C 通訊
// 參數：無
// 傳回值：無
// 流程：
//   1. 呼叫 BMht.begin() 初始化感測器
//   2. 序列埠輸出初始化成功訊息
// ---------------------------------------------------------------
void initDHT()
{
    // 初始化感測器，啟動 I2C 通訊
    // 此函式會設定 I2C 通訊參數並與感測器建立連線
    BMht.begin();
    
    // 在序列埠輸出初始化成功訊息
    // 用於偵錯和確認感測器初始化是否成功
    Serial.println("init Temperature OK");
    
    // 注意：函式名稱中的拼寫錯誤（"Temerature" 應為 "Temperature"）
}

// ---------------------------------------------------------------
// 函式名稱：readTemperature()
// 功能：讀取溫度值
// 參數：無
// 傳回值：float - 溫度值（攝氏度）
// 流程：
//   1. 呼叫 BMht.readTemperature() 讀取感測器溫度資料
//   2. 將讀取的溫度值更新到全域變數 TValue（在呼叫端執行）
//   3. 傳回溫度值
// ---------------------------------------------------------------
float readTemperature()
{
    // 讀取溫度值並直接傳回
    // BMht.readTemperature() 會透過 I2C 向感測器發送讀取指令
    // 並將讀取的原始資料轉換為攝氏溫度值
    return BMht.readTemperature();
}

// ---------------------------------------------------------------
// 函式名稱：readHumidity()
// 功能：讀取濕度值
// 參數：無
// 傳回值：float - 濕度值（百分比）
// 流程：
//   1. 呼叫 BMht.readHumidity() 讀取感測器濕度資料
//   2. 將讀取的濕度值更新到全域變數 HValue（在呼叫端執行）
//   3. 傳回濕度值
// ---------------------------------------------------------------
float readHumidity()
{
    // 讀取濕度值並直接傳回
    // BMht.readHumidity() 會透過 I2C 向感測器發送讀取指令
    // 並將讀取的原始資料轉換為百分比濕度值
    return BMht.readHumidity();
}

// ---------------------------------------------------------------
// 函式名稱：getVersion()
// 功能：讀取感測器韌體版本號
// 參數：無
// 傳回值：String - 韌體版本字串
// 流程：
//   1. 呼叫 BMht.getFWVer() 讀取韌體版本
//   2. 將讀取結果轉換為 String 格式並傳回
// ---------------------------------------------------------------
String getVersion()
{
    // 讀取韌體版本號
    // BMht.getFWVer() 傳回的是內建的資料型別，透過 String() 轉換為字串
    return String(BMht.getFWVer());
}

// ---------------------------------------------------------------
// 函式名稱：getProductNumber()
// 功能：讀取產品編號（Product ID）
// 參數：無
// 傳回值：String - 產品編號字串
// 注意：函式名稱有拼寫錯誤（"Numbetr" 應為 "Number"）
// ---------------------------------------------------------------
String getProductNumbetr()
{
    // 讀取產品編號（PID）
    // BMht.getPID() 讀取感測器的產品識別碼
    return String(BMht.getPID());
}

// ---------------------------------------------------------------
// 函式名稱：getSNNumber()
// 功能：讀取產品序號（Serial Number）
// 參數：無
// 傳回值：String - 產品序號字串
// 注意：函式名稱有拼寫錯誤（"Numbetr" 應為 "Number"）
// ---------------------------------------------------------------
String getSNNumbetr()
{
    // 讀取產品序號（SN）
    // BMht.getSN() 讀取感測器的唯一序列號
    return String(BMht.getSN());
}

// ---------------------------------------------------------------
// 函式名稱：ShowDHTInformation()
// 功能：印出溫溼度感測器的完整產品資訊
// 參數：無
// 傳回值：無
// 輸出格式：
//   =======DeviceInfo(HEX)=========
//   SN : [序號]
//   PID : [產品編號]
//   VER : [韌體版本]
//   ===============================
// ---------------------------------------------------------------
void ShowDHTInformation()
{
    // 輸出資訊分隔線
    Serial.println("=======DeviceInfo(HEX)========= ");
    
    // 輸出產品序號（SN）
    Serial.print("SN : ");
    Serial.println(getSNNumbetr());  // 以十六進位格式顯示序號
    
    // 輸出產品編號（PID）
    Serial.print("PID : ");
    Serial.println(getProductNumbetr());  // 顯示產品 ID
    
    // 輸出韌體版本（VER）
    Serial.print("VER : ");
    Serial.println(getVersion());  // 顯示韌體版本
    
    // 輸出結束分隔線
    Serial.println("=============================== ");
}
